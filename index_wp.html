<!DOCTYPE html>
<html lang="en"> 
	<head>
		<meta charset="utf-8">
		<title>Test</title>

		<script src="https://code.jquery.com/jquery.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<link rel="stylesheet" href="styles.css">
	</head>
	<body>
<div class="arttitle"><strong>Plot Me <i>Genderfluid</i></strong></div>	
<div class = "intro">
	<div class="sectitle"><strong>What the what?</strong></div>
	<p>Let’s kick things off with a 101 – What is genderfluid / gender-fluid / gender fluid?</p>
	<p>Not too much of mystery anymore, in September 2016 we made the <a href="https://www.merriam-webster.com/dictionary/gender-fluid" target="_blank" rel="noopener">dictionary!</a></p>
	<div class="imgtitle">Merriam Webster Dictionary Definition</div>
	<img src="https://www.gaytascience.com/wp-content/uploads/2018/05/def.jpg">
	<p>So genderfluidity is characterized by moving between genders, or with a fluctuating gender identity!</p>
	<p>This is also a good time to mention that gender is social construct (so is sex if we <i>really</i> want to get into it), there are more than 2 genders (infinite in fact), and that genderfluidity falls under the non-binary umbrella, which in turn falls under the trans umbrella.</p>
	<p>Is this completely foreign? No problem, it can be confusing when your understanding of gender is expanded beyond the typical “Man” / “Woman” (no, seriously, that is pretty much what this entire piece is about!). Here is a short list of trans 101 – type resources:</p>
	<ul>
  		<li>PFLAG has a pretty nice <a href="https://www.pflag.org/glossary" target="_blank" rel="noopener">glossary of LGBTQ+ terms</a></li>
  		<li>So does <a href="https://www.thetrevorproject.org/trvr_support_center/glossary/" target="_blank" rel="noopener">The Trevor Project</a></li>
  		<li>Gold star for <a href="http://itspronouncedmetrosexual.com/2013/01/a-comprehensive-list-of-lgbtq-term-definitions/" target="_blank" rel="noopener">this list</a> though (for those that want to go above and beyond)</li>
  		<li>A pretty good summary of <a href="https://www.genderspectrum.org/quick-links/understanding-gender/" target="_blank" rel="noopener">gender dimensions</a></li>
  		<li><a href="https://www.genderbread.org/resource/genderbread-person-minimal-3-3" target="_blank" rel="noopener">“The Genderbread Person”</a> is a constantly improving educational tool for breaking down gender identity vs sex vs expression and more!</li>
	</ul>
	<img src="https://www.gaytascience.com/wp-content/uploads/2018/05/genderbreadss.jpg">	
</div>

<div class = "history">
	<div class="sectitle"><strong>My Journey</strong></div>
	<p><strong>TW: Internalized Transphobia (but it turns out ok in the end!</strong></p>
	<p>In hindsight, I have always been genderfluid – my personal experience being fluctuating between typical masculine, feminine, gender neutral, and agender identities. However, without knowing that the concept of genderfluidity was a thing until my mid 20’s, these fluctuations were the cause of much confusion growing up. Assigned female at birth (afab), as a kid I was described as “tomboy-ish”, often taking pride in rejecting stereotypically girly things. I often felt like I was born in the “wrong body”. I have very clear memories of reading a <a href="https://www.amazon.com/He-Girl-Marvin-Redpost-No/dp/0679819487" target="_blank" rel="noopener">Louis Sachar book</a> in elementary school where the boy kisses his elbow and turns into a girl. It was supposed to speak to gender differences and social taboos or something – but that apparently didn’t resonate. I just remember spending hours trying to kiss my elbow so I could turn into a boy. I did not succeed.</p>
	<div class="row">
		<div class="col-sm-4 col-md-4 col-lg-4 text-center"><img style="max-width: 400px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/ch4_sq.jpg" title="5 or 6ish?" height="100%" width="100%"></div>
		<div class="col-sm-4 col-md-4 col-lg-4 text-center"><img style="max-width: 400px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/ch_sq.jpg" title="7 or 8" height="100%" width="100%"></div>
		<div class="col-sm-4 col-md-4 col-lg-4 text-center"><img style="max-width: 400px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/ch2_sq.jpg" title="Me and McGruff, circa 3rd grade" height="100%" width="100%"></div>	
	</div>
	<p>I femme’d it up a bit around puberty, cause expectations. In high school I met my partner and realized I wasn’t straight. Looking back I think my gender identity complicated and delayed that realization a bit – I would confuse looking at boys in an envious way as sexual attraction. In college, I started questioning my gender identity more. There were many aspects of my current and childhood experiences that fell in line with a typical FTM (female-to-male) narrative. Since I didn’t know anything outside the gender binary, if I didn’t and had never felt fully female, I must be male! Early college I explored this, I dressed pretty masculine, and actually “passed” often in social settings. I remember my mom on the phone once being all mom-ish like “You don’t walk alone at night do you? It’s not safe for young women to walk alone at night!” and just laughing in my head because of how rarely I got clocked as female by strangers. I was that confident!</p>
	<div class="row">
		<div class="col-sm-4 col-md-4 col-lg-4 text-center"><img style="max-width: 400px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/mid_sq.jpg" title="7th grade feat. EYESHADOW!" height="100%" width="100%"></div>
		<div class="col-sm-4 col-md-4 col-lg-4 text-center"><img style="max-width: 400px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/hs1_sq.jpg" title="High school" height="100%" width="100%"></div>
		<div class="col-sm-4 col-md-4 col-lg-4 text-center"><img style="max-width: 400px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/colpic_sq.jpg" title="Freshman year, feat. brown hair" height="100%" width="100%"></div>	
	</div>
	<p>I considered transitioning during this time, but the unstable nature of my unknown genderfluidity could not be ignored. No matter how much I was trying to fit into this typical trans narrative, occasionally I would have periods where I felt genuinely and intensely feminine! How could I transition if this happened? By about my sophomore year I was tired of struggling and being confused. I told myself that obviously I didn’t “feel it strongly enough” to start hormones or do any sort of physical or social transition. So if I wasn’t going to do anything about it I was just going to have to be happy being female. I started presenting more feminine (still in my “tomboy-ish” or gender neutral way) and stifled any remaining trans questions.</p>
	<p>Notable though was that in 2009 (probably my Junior year) <a href="http://kandmcqueen.com" target="_blank" rel="noopener">Dr. Kand McQueen</a> came to my school and gave a presentation on gender identity and the gender dichotomy. It was such an enlightenment for me, I had literally no concept of gender beyond the binary before this time! This was the first exposure I had to the transgender umbrella, non-binary identities, and the concept of genderqueer or gender-neutrality. I was more just amazed at the concept in general, but I guess I did look internally a bit, thinking maybe I fell somewhere on the genderqueer spectrum - but still not allowing myself to really fret about gender again since “I wasn’t going to do anything about it”.</p>

	<p><img style="max-width: 400px; padding: 0 15px; float: left; padding-bottom: 10px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/wk_sq.jpg" title="1 year at my job, wooo" height="100%" width="100%"> Fast forward to February 2014, I was 24, a friend’s partner was desperate to find some LGBT folks to fill out a panel for a university class she taught - I was a willing gay. During the panel something amazing happened. One of the other panel members explained that he currently identified as a homosexual man, but he believed that gender and sexuality was fluid, so that might change in the future. My mind was blown, I had never considered before that moment that these things could change. I had always imagined them as fixed and it just took you time to realize what you were.</p> 
	<p> I didn’t connect the dots right away though – it was presented as gender/sexual orientation can shift over time, not the daily or even more frequent fluctuations I experienced. But, as luck would have it, this was right around the time that Facebook introduced their expanded gender options. I was browsing an <a href="https://www.thedailybeast.com/what-each-of-facebooks-51-new-gender-options-means" target="_blank" rel="noopener">article about it</a> when the genderfluid definition caught my eye (likely because of the panel comments from earlier).</p>
	<img src="https://www.gaytascience.com/wp-content/uploads/2018/05/gf-fbarticledef.jpg">

	<p>I remember reading the definition and just feeling the most intense sense of relief. This was it! After years of feeling broken and weird and alone, my experience had a name, there were presumably others out there like me! I probably cried. It was ironic how someone who was known to be very “ugh, labels are so stifling” found so much freedom in this one. I told my partner - literally the most open-minded person I know and who had been supportively by my side since I was 16 – immediately, and we jumped up and down excited.</p>
</div>

<div class = "datasplain">
	<div class="sectitle"><strong>Daily Tracking </strong></div>
	<p>While it was freeing to finally find the “label” that described my experience, this was really just the beginning of another journey. My genderfluid realization came with its own basket of complications. While I considered myself to be an open-minded person and an advocate for other’s queer identities, for some reason I had a hard time fully accepting it when it was personal. Initially it turned into, “yea I’m genderfluid, but I’m going to force myself to be feminine because I need control”. As this inevitably started affecting my life negatively, I was urged by a therapist to start tracking my gender fluctuations so that I could understand them better. It was good advice, and because I am a data nerd, I ended up taking it to a whole other level.</p>
	<p>I started a spreadsheet and logged my gender daily. I created a scale from -5 to 5 to document where I fell for the day. A value of -5 indicated a highly masculine day, whereas a value of 5 specified an extremely feminine day. A value of 0 represented a purely neutral day, either in the agender (without gender) or genderqueer (mix of masculine/feminine) sense. I know the gender spectrum concept isn’t completely accurate, but it was helpful in representing things for me. I also kept track of the max and min of the gender scale for days that had multiple fluctuations, although to simplify the results shown here I only consider the overall daily gender value. In addition to the gender scale measures, I kept a free text column to write my thoughts or feelings about the day. I logged this information daily for over 3 years, from November 2014 to December 2017.</p>
	<div class="imgtitle">View of my Data</div>
	<img style="padding-top: 5px; max-width: 600px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/dataview.jpg">
	<p>This setup of my data was specific to my experience of genderfluidity. I knew I fluctuated between our society’s typical definitions of masculinity, femininity, gender neutrality and occasionally agender. Others who identify as genderfluid might have a drastically different experience.</p>
	<p>How do I define these things, in particular masculinity and femininity? That is indeed the question and I found as I worked through things my definitions also drastically changed. Initially, although I didn’t see it at the time, I had a very shallow understanding of gender - rooted in stereotypes, tropes, and other shitty things that are beaten into us when we live in this aggressively gendered society. In terms of the daily ranking I kept for my data though, I just “know” what gender I am if I check in with myself. It’s usually pretty clear, in the same way I imagine a cis woman “knows” they are a women.</p>
	<p>For the purpose of visualization, I binned my gender scale into 3 categories (even though it kind of takes away from the spirit of genderfluidity and the gender spectrum). It helps with understanding. -5 to -3 are categorized as a "masculine" day, -2 to 2 as a "neutral" day, and 3-5 as a "feminine" day. Also before I get flak for using gendered colors (pink/blue) in the visualizations – they are used ironically and to help with clarity (since I know y’all just look at the pictures and don’t actually read my beautiful commentary). Trust me I know it is BS - anyone who has spent more than 20 minutes with me has likely gotten an earful of my thoughts about societies aggressive gendering of things that have no gender!</p>
	<div class="sectitle"><strong>Data for Personal Discovery</strong></div>
	<p>Collecting and analyzing this data was a way for me to understand and quantify my experience. At the beginning of the exercise, I was struggling most with lack of control/predictability. Gender swings would come out of nowhere and would completely blindside me. So many emotions would come with a gender fluctuation since gender affected so many aspects of my life (we live in a highly gendered society if you didn’t know!). Most switches would come with changes to my mood, present-ness, comfort levels, social confidence, etc. Also masculine periods would often come with gender dysphoria, a term used in trans circles to describe intense distress felt due to a mismatch between physical and/or social appearance and gender. There was also a lot of feeling alone, different, “broken”.
	At the same time I knew that I needed to find a way to be ok with the uncertainty because my genderfluidity was likely here to stay. So made a pact to not over - data science things. I would only do exploratory/explanatory analyses, there would be no trying to predict no matter how much I wanted to “7-day Forecast” my gender.</p> 
	<p>I also knew I was prone to overanalyzing (what?!? shocking!). In hindsight it is clear that initially I was constantly searching for “reasons” to explain the shifts.</p>
	<ul>
  		<li>Sometimes in search of control</li>
  		<li>Sometimes to shame myself for buying into societies gender norms or stereotypes</li>
  		<li>At the extremes to question my identities validity – instead maybe it could be explained away by some other factors (hormones, social circles, environment, etc)</li>
	</ul>
	<p>But as time passed and I worked through things, the search for reasons started to wane. I now realize the most valuable “finding” in doing this was validating my identity to myself. I could never find consistent outside explanations for my shifts, this is honestly just me.</p>
</div>

<div class = "dashdesc">
	<div class="sectitle"><strong>The Basics</strong></div>
	<div class="row">
		<div class="col-sm-3 col-md-3 col-lg-3 text-center"><img style="max-width: 200px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/bd_lineplot.jpg" title="Plotting Gender Over Time" height="100%" width="100%"></div>
		<div class="col-sm-9 col-md-9 col-lg-9 text-left sidetext">
			<p><strong>Gender Over Time</strong></p>
			<p>Because the main (or most apparent) struggle I was having initially was a lack of control or predictability, just plotting my gender over time was a huge eye-opener. Things were so overwhelming it felt as though my gender was constantly flip-floppin without warning, however, plotting it showed that my reality was much more stable than how it felt in the moment. I would almost always have a period of neutrality before switching from one extreme to the other.</p>
		</div>	
	</div>
	<div class="row desktop">
		<div class="col-sm-8 col-md-8 col-lg-8 text-left">
			<p><strong>Gender Distribution</strong></p>
			<p>Looking at my overall distribution of gender was also helpful in understanding the basics of what was going on. I heavily skew neutral (although the “scale” representation is limiting – 0’s don’t distinguish between feeling “in the middle” or a “equal mix of M and F” from the a-gender sense of “not M or F”. But, still valuable information. Across the entire tracking period, I clocked in at 50% Neutral days, 32% Masculine days, and 18% Feminine days. The histogram shows the trends within each category.</p>
		</div>	
		<div class="col-sm-4 col-md-4 col-lg-4 text-center"><img style="max-width: 300px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/bd_dist.jpg" title="tites" height="100%" width="100%"></div>
	</div>
	<div class="row mobile">
		<div class="col-sm-8 col-md-8 col-lg-8 text-left">
			<div class="col-sm-4 col-md-4 col-lg-4 text-center"><img style="max-width: 300px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/bd_dist.jpg" title="tites" height="100%" width="100%"></div>
			<p><strong>Gender Distribution</strong></p>
			<p>Looking at my overall distribution of gender was also helpful in understanding the basics of what was going on. I heavily skew neutral (although the “scale” representation is limiting – 0’s don’t distinguish between feeling “in the middle” or a “equal mix of M and F” from the a-gender sense of “not M or F”. But, still valuable information. Across the entire tracking period, I clocked in at 50% Neutral days, 32% Masculine days, and 18% Feminine days. The histogram shows the trends within each category.</p>
		</div>	
	</div>
	<div class="row">
		<div class="col-sm-3 col-md-3 col-lg-3 text-center"><img style="max-width: 300px;" src="https://www.gaytascience.com/wp-content/uploads/2018/05/bd_guage.jpg" height="100%" width="100%"></div>
		<div class="col-sm-9 col-md-9 col-lg-9 text-left sidetext">
			<p><strong>Gender Overall</strong></p>
			<p>I also further rolled things up to see where I fell on the gender spectrum overall. This was just a straight average of all the days in my -5 to 5 ranged scale. For example, over 3 years of data found me falling just masculine of center, at -0.42.</p>
		</div>	
	</div>

	<p>I ended up fashioning these visualizations into a dashboard so that I could further explore my gender fluctuations during different time periods. Also I wanted to learn d3.js, so two birds with one stone!</p> 
	<p><strong>Navigated tour below, standalone tool available <a href="https://www.gaytascience.com/gender-tracker" target="_blank" rel="noopener">here</a> if you’d like to explore. Refresh page if scrolly is off or not working</strong></p>

</div>

<div id='container' class='container'>
	<div id='graph'>
			<div class = "row text-left" id="daterange" >
				<h2><span id="value">100</span></h2>
			</div>
			<div class="row row-graph">
				<div class="col-xs-7 col-sm-7 col-md-7 col-lg-7 text-right line-container pull-bottom" id="svg"></div>
				<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5 text-left pull-bottom row graph-body">
								<div class="row text-left" id = "ntooltip">
									<h1><span id="value">100</span></h1>
								</div>
								<div class="row text-left  svg-container" id="chart-gauge">
								</div>
								<div class="row text-left">
									<h1><strong>Distribution of Selection</strong></h1>
								</div>
								<div class="row text-left  svg-container" id="chart-hist">
								</div>
				</div>
			</div>
	</div>
	<div id='sections'>
	  <div class='step'>
	    <div class="sectitle"><strong>Monthly Moves</strong></div>
	    A month might have 1-2 feminine and masculine periods, each lasting from a day or two to longer than a week. Between extremes, I typically spend significant time in the neutral zone. Dragging the brush (dark shaded part of middle graph) up and down the timeline will allow you to see monthly snapshots overtime. Nov 2016 – entirely neutral-masculine!
	  </div>
	  <div class='step'>
	    <div class="sectitle"><strong>Early On</strong></div>
	     The first full year of tracking I clocked in at 51% Neutral days, 28% Masculine days, and 21% Feminine days. The chart shows that this translates to around 20 masculine swings and 14 feminine periods over the year. 
	  </div>
	  <div class='step'>
	  	<div class="sectitle"><strong>And Later</strong></div>
	    Two years later, the story changes a bit. I’m now spending 52% of days in the Neutral zone, 32% Masculine, and 15% Feminine. Overall this brings my average gender further blue to -0.58, however, still firm in the neutral zone. 2017 also realized an increase in the number of swings as well – going up to 27 masculine and 18 feminine periods during the year.  
	  </div>
	  <div class='step'>
	  	<div class="sectitle"><strong>Post "Aha!"</strong></div>
	    Inspecting the overall timeline, seems that these 2017 changes maybe have actually started back in April of 2016. Visually the fluctuations appear tighter and more frequent compared to the prior time period. A couple things were happening at this point in time. First, a major life change as I was finishing my master’s degree and moving to a new state to start a new job. Second, a pretty major shift in my thinking happened mid-month – an “aha! moment” for you Oprah fans. More on this later. 
	  </div>
	</div>

</div>

<div>
	<h1> TITLE </h1>
	<p> Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text
	Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text 
	Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text </p>
</div>
<div>
	<h1> TITLE </h1>
	<p> Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text
	Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text 
	Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text </p>
</div>
<div>
	<h1> TITLE </h1>
	<p> Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text
	Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text 
	Text text text text text text text text text Text text text text text text text text text Text text text text text text text text text </p>
</div>

<script src="https://code.jquery.com/jquery.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<!-- <script type="text/javascript" src="d3/d3.js"></script> -->
<script charset="utf-8" src="https://d3js.org/d3.v4.min.js"></script>
<!-- <script src="scroller.js"></script> -->
<script src="https://1wheel.github.io/graph-scroll/graph-scroll.js"></script>
<script type="text/javascript">

$(document).ready(function(){
		var graph = d3.selectAll('#graph');
		var container = d3.select('#container');
		var sections = d3.selectAll('#sections > .step');
		var graphScroll = d3.graphScroll()
				.graph(graph)
				.container(container)
				.sections(sections)
				
				.on('active', function(i){
					console.log(i);
					console.log(document.getElementById("container").className == "container graph-scroll-fixed");
						if (i == 0) {
							updatedash("06/30/2015", "08/01/2015");	
						} else if (i == 1 && document.getElementById("container").className == "container graph-scroll-fixed") {
							updatedash("01/01/2015", "12/31/2015");
						} else if (i ==2 && document.getElementById("container").className == "container graph-scroll-fixed") {
							updatedash("01/01/2017", "12/31/2017");
						} else if (i == 3 && document.getElementById("container").className == "container graph-scroll-fixed") {
							updatedash("04/15/2016", "12/31/2017");
						} else {
							updatedash("06/01/2015", "11/20/2015");
						}  
					
				})
				//.on('active', function(i){ console.log(i + 'th section active'); })
		graphScroll.offset(300);

});
		
		// LINE PLOTS
		//----------------------------------------------------------------------

		// Set up chart space
		var margin = {top: 10, right: 150, bottom: 30, left: 60},
		 		margin2 = {top: 10, right: 20, bottom: 30, left: 525},
				width = 600 - margin.left - margin.right,
				width2 = 600 - margin2.left - margin2.right,
    		height = 640 - margin.top - margin.bottom;

		var svg = d3.select("#svg").append("svg")
								.attr("preserveAspectRatio", "xMinYMin meet")
								.attr("viewBox", "0 0 600 640")
								.classed("line-content", true);
								// .attr("width", 600)
								// .attr("height", 700);

    	// Assign Colors
    	var blue = '#ADD8E6'; //'#71a3f2'; 
    	var yellow = '#ddddbc'; //'#FFFFE0'; //#f7d367';
    	var pink = '#FFB6C1'; //#f78ce2';

		// Read in Data
		var parseTime = d3.timeParse("%m/%d/%Y");

		// Create Scales
		var yScale = d3.scaleTime().range([height,0]),
		    y2Scale = d3.scaleTime().range([height,0]),
	      xScale = d3.scaleLinear().range([0, width]),
				x2Scale = d3.scaleLinear().range([0, width2]);

		// define the main line
		var valueline = d3.line()
		    .x(function(d) { return xScale(d.scale); })
		    .y(function(d) { return yScale(d.date); });

		// define the brush line
		var valueline2 = d3.line()
		    .x(function(d) { return x2Scale(d.scale); })
		    .y(function(d) { return y2Scale(d.date); });

		// Custome time format
		var formatMillisecond = d3.timeFormat(".%L"),
		    formatSecond = d3.timeFormat(":%S"),
		    formatMinute = d3.timeFormat("%I:%M"),
		    formatHour = d3.timeFormat("%I %p"),
		    formatDay = d3.timeFormat("%a %d"),
		    formatWeek = d3.timeFormat("%b %d"),
		    formatMonth = d3.timeFormat("%B"),
		    formatYear = d3.timeFormat("%Y");

		function multiFormat(date) {
		  return (d3.timeSecond(date) < date ? formatMillisecond
		      : d3.timeMinute(date) < date ? formatSecond
		      : d3.timeHour(date) < date ? formatMinute
		      : d3.timeDay(date) < date ? formatHour
		      : d3.timeMonth(date) < date ? (d3.timeWeek(date) < date ? formatDay : formatWeek)
		      : d3.timeYear(date) < date ? formatMonth
		      : formatYear)(date);
		}

		// Create Axes
		var yAxis = d3.axisLeft()
		    .scale(yScale)
			.tickFormat(multiFormat);

		var y2Axis = d3.axisLeft()
		    .scale(y2Scale)
			.tickFormat(multiFormat);

		var xAxis = d3.axisBottom()
		    .scale(xScale);

		var x2Axis = d3.axisBottom()
		    .scale(x2Scale)
			.ticks(3);

		var brush = d3.brushY()
			.extent([[0,0], [width2, height]])
			.on("brush end", brushed);

		// Append SVG object
		svg.append("defs").append("clipPath")
    		.attr("id", "clip")
  			.append("rect")
    		.attr("width", width)
    		.attr("height", height);

		var focus = svg.append("g")
		    .attr("class", "focus")
		    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		var context = svg.append("g")
		    .attr("class", "context")
		    .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

		//Color Background - Focus Graph
		var bluerec = focus.append("rect")
			.attr("x", 0)
			.attr("y", 0)
    	    .attr("width", xScale(.3))
    	    .attr("height", height)
    	    .style('opacity', 0.5)
    	    .style('fill', blue);

		var yellowrec = focus.append("rect")
			.attr("x", xScale(.3))
			.attr("y", 0)
		    .attr("width", xScale(.4))
		    .attr("height", height)
		    .style('opacity', 0.5)
		    .style('fill', yellow);

		var pinkrec = focus.append("rect")
			.attr("x", xScale(.7))
			.attr("y", 0)
		    .attr("width", xScale(.3))
		    .attr("height", height)
		    .style('opacity', 0.5)
		    .style('fill', pink);

		// Reference Line - Focus Graph
		var zeroline = focus.append("line")
			.attr("y1", 0)
			.attr("y2", height)
			.attr("x1", xScale(.5))
			.attr("x2", xScale(.5))
			.attr("stroke", "black")
			.attr("stroke-width", "1.5")
			.style("stroke-dasharray", ("6, 6"));

		//Color Background - Context Graph
		var bluerec = context.append("rect")
			.attr("x", 0)
			.attr("y", 0)
    	    .attr("width", x2Scale(.3))
    	    .attr("height", height)
    	    .style('opacity', 0.5)
    	    .style('fill', blue);

		var yellowrec = context.append("rect")
			.attr("x", x2Scale(.3))
			.attr("y", 0)
		    .attr("width", x2Scale(.4))
		    .attr("height", height)
		    .style('opacity', 0.5)
		    .style('fill', yellow);

		var pinkrec = context.append("rect")
			.attr("x", x2Scale(.7))
			.attr("y", 0)
		    .attr("width", x2Scale(.3))
		    .attr("height", height)
		    .style('opacity', 0.5)
		    .style('fill', pink);

		// Reference Line - Context Graph
		var zeroline = context.append("line")
			.attr("y1", 0)
			.attr("y2", height)
			.attr("x1", x2Scale(.5))
			.attr("x2", x2Scale(.5))
			.attr("stroke", "black")
			.attr("stroke-width", "1")
			.style("stroke-dasharray", ("3, 3"));

		// Get data
		//data/data.csv
		//https://www.gaytascience.com/wp-content/uploads/2018/05/data.csv
		d3.csv("data/data.csv", function(error, data) {
		  if (error) throw error;

		// format the data
		data.forEach(function(d) {
		   	d.date = parseTime(d.date);
		   	d.scale = parseInt(d.scale);
		});

		// Set scale domains based on data
		yScale.domain(d3.extent(data, function(d) { return d.date }));
		xScale.domain([-5,5]);
		y2Scale.domain(d3.extent(data, function(d) { return d.date }));
		x2Scale.domain([-5,5]);

		// FOCUS GRAPH
		//----------------------------------------------------------------------

		// Function to format date for tooltip
		formatTime = d3.timeFormat("%m/%d/%Y");

		// Add the valueline path.
	  focus.append("path")
	       .data([data])
	       .attr("class", "line")
	       .attr("d", valueline);

		// Add Scatterplot
		focus.selectAll("dot")
			.data(data)
			.enter().append("circle")
			.attr("r", 2.5)
			.attr("cx", function(d) { return xScale(d.scale); })
			.attr("cy", function(d) { return yScale(d.date); })
			.attr("class", "dots")
			.on ("mouseover", function(d) {
				//Get this dots x/y values, then augment for the tooltip
				var xPosition = d3.select(this).attr("cx");
				var yPosition = parseFloat(d3.select(this).attr("cy")) - 10;

				//Create the tooltip label
			 focus.append("text")
					.attr("id", "ltooltip")
					.attr("x", xPosition)
					.attr("y", yPosition)
					.attr("text-anchor", "middle")
					.attr("font-family", "sans-serif")
					.attr("font-size", "14px")
					.attr("font-weight", "bold")
					.attr("fill", "black")
					.text(formatTime(d.date) + ", " + "Scale: " + d.scale);
					})

			.on("mouseout", function() {
					//Remove tooltip
					d3.select("#ltooltip").remove();
				})

		// Draw Axes
		focus.append("g")
		    .attr("class", "xaxis")
		    .attr("transform", "translate(0," + height + ")")
		    .call(xAxis);

		focus.append("g")
		    .attr("class", "yaxis")
		    .call(yAxis);

		// CONTEXT GRAPH
		//----------------------------------------------------------------------

		// Add the valueline path.
		context.append("path")
		    .data([data])
		    .attr("class", "line")
		    .attr("d", valueline2);

		// Draw Axes
		context.append("g")
		    .attr("class", "xaxis")
		    .attr("transform", "translate(0," + height + ")")
		    .call(x2Axis);

		context.append("g")
		    .attr("class", "yaxis")
		    .call(y2Axis);

		context.append("g")
		    .attr("class", "brush")
		    //.call(brush)
		    //.call(brush.move, [yScale.range()[1] + (yScale.range()[0])/2 , (yScale.range()[0])/2 + (yScale.range()[0])/4]);
		    //console.log([parseTime("01/19/2015"), parseTime("08/01/2015")].map(y2Scale))
		    //.call(brush.move, [parseTime("01/19/2015"), parseTime("08/01/2015")].map(y2Scale).reverse());

		});
		
		function updatedash(date1, date2) {
			context.call(brush).call(brush.move, [parseTime(date1), parseTime(date2)].map(y2Scale).reverse());
		}

		function brushed() {;

		  if (d3.event.sourceEvent && d3.event.sourceEvent.type === "zoom") return; // ignore brush-by-zoom
		  var s = d3.event.selection || y2Scale.range(),
					array = [];
					counts = {};
		  yScale.domain(s.map(y2Scale.invert, y2Scale).reverse());
		  focus.select(".line").attr("d", valueline);
		  focus.selectAll(".dots").attr("r", 2.5).attr("cx", function(d) { return xScale(d.scale); }).attr("cy", function(d) { return yScale(d.date); });
		  focus.select(".yaxis").call(yAxis);
			// Figure out selected data for other viz's
			for (i = 0; i < focus.selectAll(".dots")._groups[0].length; i++) {
				var dotdate = yScale.invert(focus.selectAll(".dots")._groups[0][i].cy.animVal.value),
				 		lowerbrush = s.map(y2Scale.invert, y2Scale).reverse()[0],
						upperbrush = s.map(y2Scale.invert, y2Scale).reverse()[1],
						dotscale = xScale.invert(focus.selectAll(".dots")._groups[0][i].cx.animVal.value);
				if ( dotdate > lowerbrush && dotdate <= upperbrush ) {
					//keep the # to average for gauge
					array.push(dotscale);
					//add dot to the counts for hist
					var key = dotscale;
					if (counts[key]) {
							counts[key]++;
					}
					else {
							counts[key] = 1;
					}
				};
			 }

			// Average the selected points
			var sum = 0;
			for (j = 0; j < array.length; j++) {
				sum += array[j];
			}
			var avg = sum / array.length;

			// Move gauge
			needle.animateOn(chart, (avg+5)/10);

			d3.select("#ntooltip")
					.select("#value")
					.html("<strong>" + "Scale Average: " + "</strong>" + d3.format("1.4")(avg));

			// Make hist final dataset
			var final = [];
			for (var key in counts) {
			    final.push({
						key: key,
						value: counts[key]
					});
			};

			// Update Bars
			updatehist(final);

			// update y Axis
			hsvg.select(".yaxis_bar")
					.transition()
					.call(d3.axisLeft(y));
					//.ticks(d3.max(final, function(d) { return d.value })));

			// Change Date Range Labeling
			d3.select("#daterange")
				.select("#value")
			    .html("<strong>" + "Selected Date Range: " + "</strong>" + formatTime(lowerbrush) + " - " + formatTime(upperbrush));

		}

// GAUGE!!!
// -----------------------------------------------------------------------------------

var percent = percent, //For  my data +5 and then /10
		barWidth = 40,
		numSections = 3,
 		sectionPerc = 1 / numSections / 2,
		padRad = 0.05,
		chartInset = 10,
		totalPercent = .75,

		el = d3.select('#chart-gauge'),

		gmargin = {
			top: 0,
			right: 20,
			bottom: 15,
			left: 70
		},

		gwidth = 380//el._groups[0][0].offsetWidth - gmargin.left - gmargin.right,

		gheight = gwidth / 2,

		radius = gwidth / 2 ;

var percToDeg = function(perc) {
	return perc * 360;
};

var percToRad = function(perc) {
	return degToRad(percToDeg(perc));
};

var degToRad = function(deg) {
	return deg * Math.PI / 180;
};

var svg_gauge = el.append('svg')
				  .attr("preserveAspectRatio", "xMinYMin meet")
				  .attr("viewBox", "0 0 445 230")
				  .classed("svg-content", true);

// var svg_gauge = el.append('svg').attr('width', gwidth + gmargin.left + gmargin.right).attr('height', gheight + gmargin.top + gmargin.bottom);

var chart = svg_gauge.append('g') .attr('transform', "translate(" + ((gwidth + gmargin.left) / 2) + ", " + ((gheight + gmargin.top)) + ")");

for (sectionIndx = i = 1, ref = numSections; 1 <= ref ? i <= ref : i >= ref; sectionIndx = 1 <= ref ? ++i : --i) {
	arcStartRad = percToRad(totalPercent);
	arcEndRad = arcStartRad + percToRad(sectionPerc);
	totalPercent += sectionPerc;
	startPadRad = sectionIndx === 0 ? 0 : padRad / 2;
	endPadRad = sectionIndx === numSections ? 0 : padRad / 2;
	arc = d3.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth).startAngle(arcStartRad + startPadRad).endAngle(arcEndRad - endPadRad);
	chart.append('path').attr('class', "arc chart-color" + sectionIndx).attr('d', arc);
}

Needle = (function() {

	function Needle(len, radius1) {
		this.len = len;
		this.radius = radius1;
	}

	Needle.prototype.drawOn = function(el, perc) {
		el.append('circle').attr('class', 'needle-center').attr('cx', 0).attr('cy', 0).attr('r', this.radius);
		return el.append('path').attr('class', 'needle').attr('d', this.mkCmd(perc));
	};

	Needle.prototype.animateOn = function(el, perc) {
		var self;
		self = this;
		return el.transition().delay(10).ease(d3.easeElastic).duration(3000).selectAll('.needle').tween('progress', function() {
			return function(percentOfPercent) {
				var progress;
				progress = percentOfPercent * perc;
				return d3.selectAll('.needle').attr('d', self.mkCmd(progress));
				};
			});
		};

	Needle.prototype.mkCmd = function(perc) {
		var centerX, centerY, leftX, leftY, rightX, rightY, thetaRad, topX, topY;
		thetaRad = percToRad(perc / 2);
		centerX = 0;
		centerY = 0;
		topX = centerX - this.len * Math.cos(thetaRad);
		topY = centerY - this.len * Math.sin(thetaRad);
		leftX = centerX - this.radius * Math.cos(thetaRad - Math.PI / 2);
		leftY = centerY - this.radius * Math.sin(thetaRad - Math.PI / 2);
		rightX = centerX - this.radius * Math.cos(thetaRad + Math.PI / 2);
		rightY = centerY - this.radius * Math.sin(thetaRad + Math.PI / 2);
		return "M " + leftX + " " + leftY + " L " + topX + " " + topY + " L " + rightX + " " + rightY;
	};

	return Needle;

	})();

	needle = new Needle(90,15);

	needle.drawOn(chart, 0);

	// HIST!!!
	// -----------------------------------------------------------------------------------

	// set the dimensions and margins of the graph
	var hmargin = {top: 20, right: 30, bottom: 30, left: 40},
			hwidth = 450 - hmargin.left - hmargin.right,
			hheight = 230 - hmargin.top - hmargin.bottom;

	// set the ranges

	var x = d3.scaleBand()
						.domain([-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5])
						.range([0, hwidth])
						.padding(0.1);

	var y = d3.scaleLinear()
						.rangeRound([hheight, 0]);

	// append the svg object to the body of the page
	// append a 'group' element to 'svg'
	// moves the 'group' element to the top left margin
	var hsvg = d3.select('#chart-hist').append("svg")
			.attr("preserveAspectRatio", "xMinYMin meet")
			.attr("viewBox", "0 0 450 230")
			.classed("svg-content", true)

			// .attr("width", hwidth + hmargin.left + hmargin.right)
			// .attr("height", hheight + hmargin.top + hmargin.bottom)
			.append("g")
			.attr("transform", "translate(" + hmargin.left + "," + hmargin.top + ")");

//To add and update bars & axes!

function updatehist(final) {

	var key = function(d) {
		return d.key;
	};

	//Update scale domains
	y.domain([0, d3.max(final, function(d) { return d.value; })]);

	// Select..
	var bars = hsvg.selectAll("rect")
			.data(final, key)

	//Enter…
	bars.enter()
		.append("rect")
		.attr("class", function(d) { return 'bar_' + d.key})
		.attr("x", function(d) {
			 return x(d.key);
		})
		.attr("y", function(d) {
			 return y(d.value);
		})
		.attr("width", x.bandwidth())
		.attr("height", function(d) {
			 return (y(0) - y(d.value));
		})

	//Update...
	bars.transition()
	.duration(500)
	.attr("class", function(d) { return 'bar_' + d.key})
	.attr("x", function(d) {
		 return x(d.key);
	})
	.attr("y", function(d) {
		 return y(d.value);
	})
	.attr("width", x.bandwidth())
	.attr("height", function(d) {
		 return (y(0) - y(d.value));
	})
	bars.on ("mouseover", function(d) {
		//Get this bar's x/y values, then augment for the tooltip
		var xPosition = parseFloat(d3.select(this).attr("x")) + x.bandwidth() / 2;
		var yPosition = parseFloat(d3.select(this).attr("y")) - 7; //+ 14 for inside bar

		//Create the tooltip label
	 hsvg.append("text")
			.attr("id", "tooltip")
			.attr("x", xPosition)
			.attr("y", yPosition)
			.attr("text-anchor", "middle")
			.attr("font-family", "sans-serif")
			.attr("font-size", "14px")
			.attr("font-weight", "bold")
			.attr("fill", "black")
			.text(d.value + " days");
			})

		bars.on("mouseout", function() {
			//Remove tooltip
			d3.select("#tooltip").remove();
		})

		//Remove bars with no values anymore
		bars.exit()
				.transition()
				.remove();

}

// add the x Axis
hsvg.append("g")
		.attr("transform", "translate(0," + hheight + ")")
		.call(d3.axisBottom(x));

// add the y Axis
// hsvg.append("g")
// 		.attr("class", "yaxis_bar")
// 		.call(d3.axisLeft(y));

		</script>
	</body>
</html>
